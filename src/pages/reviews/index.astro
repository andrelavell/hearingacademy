---
import BaseLayout from '../../layouts/BaseLayout.astro';

// Load all review markdown files in this directory
const modules = import.meta.glob('./*.md', { eager: true }) as Record<string, any>;

const FALLBACK_IMG = '/images/articles/2025-08/ai-hearing-aids-noise-pexels-14682242.jpg';

const reviews = Object.entries(modules).map(([path, mod]) => {
  const fm = mod.frontmatter || {};
  const slug = path.replace('./', '').replace(/\.md$/, '');
  const dateStr = fm.publishedTime || fm.modifiedTime || '';
  const date = dateStr ? new Date(dateStr) : null;
  const rawImage = fm.image || fm.productImage || '';
  const image = !rawImage || rawImage === '/article-default.jpg' ? FALLBACK_IMG : rawImage;
  return {
    href: `/reviews/${slug}`,
    title: fm.title || slug,
    description: fm.description || '',
    image,
    brandName: fm.brandName || '',
    productName: fm.productName || '',
    ratingValue: Number(fm.ratingValue ?? 0),
    price: fm.price,
    publishedTime: fm.publishedTime || '',
    _date: date ? date.getTime() : 0,
  };
}).sort((a, b) => b._date - a._date);
---

<BaseLayout title="Reviews" description="In-depth, unbiased reviews of hearing aids and hearing technology to help you choose with confidence.">
  <main>
    <section class="reviews-hero">
      <div class="container">
        <h1>Expert Hearing Aid Reviews</h1>
        <p>Honest, in-depth reviews of hearing aids and hearing tech—covering sound quality, comfort, features, and value.</p>
      </div>
    </section>

    <section class="reviews-content">
      <div class="container">
        {reviews.length === 0 ? (
          <p>No reviews yet. Please check back soon.</p>
        ) : (
          <div class="reviews-grid">
            {reviews.map((it) => (
              <article class="review-card">
                {it.image && (
                  <div class="review-image">
                    <img src={it.image} alt={it.title} width="400" height="250" />
                  </div>
                )}
                <div class="review-content">
                  <div class="review-meta">
                    <span class="category">Review</span>
                    {it.publishedTime && (
                      <time datetime={it.publishedTime}>
                        {new Date(it.publishedTime).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}
                      </time>
                    )}
                  </div>

                  <h2><a href={it.href}>{it.title}</a></h2>
                  {it.description && <p class="description">{it.description}</p>}

                  <div class="product-line">
                    {(it.brandName || it.productName) && (
                      <span class="product">
                        {it.brandName ? `${it.brandName}'s ${it.productName || ''}` : it.productName}
                      </span>
                    )}
                  </div>

                  <div class="badges">
                    {it.ratingValue > 0 && (
                      <span class="badge rating" aria-label={`Rated ${it.ratingValue} out of 5`}>
                        ⭐ {it.ratingValue.toFixed(1)} / 5
                      </span>
                    )}
                  </div>

                  <a href={it.href} class="read-more">Read Review</a>
                </div>
              </article>
            ))}
          </div>
        )}
      </div>
    </section>
  </main>

  <style>
    .reviews-hero {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      padding: var(--space-8) 0;
      text-align: center;
    }

    .reviews-hero p {
      font-size: var(--fs-400);
      color: var(--color-text-muted);
      max-width: 700px;
      margin: 0 auto;
    }

    .reviews-content { padding: var(--space-8) 0; }

    .reviews-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: var(--space-6);
    }

    .review-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .review-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }

    .review-image img { width: 100%; height: 250px; object-fit: cover; }

    .review-content { padding: var(--space-5); }

    .review-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-4);
      font-size: var(--fs-100);
    }

    .category {
      background: var(--color-secondary);
      color: white;
      padding: var(--space-1) var(--space-3);
      border-radius: 20px;
      font-weight: var(--fw-medium);
    }

    h2 { margin-bottom: var(--space-3); font-size: var(--fs-500); }
    h2 a { color: var(--color-text); text-decoration: none; }
    h2 a:hover { color: var(--color-primary); }

    .description { color: var(--color-text-muted); margin-bottom: var(--space-4); }

    .product-line { display: flex; flex-wrap: wrap; gap: var(--space-3); margin-bottom: var(--space-3); }
    .brand { color: var(--color-text-muted); }
    .product { font-weight: var(--fw-semibold); }

    .badges { display: flex; gap: var(--space-3); margin-bottom: var(--space-4); }
    .badge { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 999px; font-size: var(--fs-100); }
    .badge.rating { background: #fff7ed; color: #9a3412; border: 1px solid #fed7aa; }
    .badge.price { background: #ecfeff; color: #155e75; border: 1px solid #a5f3fc; }

    .read-more { color: var(--color-primary); font-weight: var(--fw-semibold); text-decoration: none; font-size: var(--fs-100); }
    .read-more:hover { text-decoration: underline; }

    @media (max-width: 768px) {
      .reviews-hero h1 { font-size: var(--fs-700); }
      .reviews-hero p { font-size: var(--fs-300); }
      .reviews-grid { grid-template-columns: 1fr; }
    }
  </style>
</BaseLayout>
